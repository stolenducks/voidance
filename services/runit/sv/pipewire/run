#!/bin/sh

# PipeWire runit service script
# Part of Voidance Linux system services

# Source function library if it exists
if [ -r /etc/rc.conf ]; then
    . /etc/rc.conf
fi

# Check if PipeWire binary exists
if ! command -v pipewire >/dev/null 2>&1; then
    echo "PipeWire binary not found"
    exit 1
fi

# Create necessary directories
mkdir -p /var/run/pipewire
mkdir -p /etc/pipewire/pipewire.conf.d

# Set up environment
export PATH="/usr/bin:/usr/sbin:/bin:/sbin"
export XDG_RUNTIME_DIR="${XDG_RUNTIME_DIR:-/run/user/$(id -u)}"

# Start PipeWire daemon
echo "Starting PipeWire..."
exec pipewire 2>&1